---
import 'flag-icons/css/flag-icons.min.css';
import { t, getLocalePath, locales, type Locale } from '../i18n/utils';

interface Props {
	title: string;
	lang?: Locale;
}

const { title, lang = 'en' } = Astro.props;

const currentPath = Astro.url.pathname;
// Strip the locale prefix to get the base path
const basePath = lang === 'en'
	? currentPath
	: currentPath.replace(`/${lang}`, '') || '/';

const localeToFlag: Record<Locale, string> = {
	en: 'gb',
	no: 'no',
	fr: 'fr',
};
---

<html lang={lang}>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet" />
		<title>{title}</title>
		<script is:inline>
			(function () {
				const stored = localStorage.getItem('theme');
				if (stored) document.documentElement.setAttribute('data-theme', stored);
			})();
		</script>
	</head>
	<body>
		<main>
			<slot />
		</main>
		<footer>
			<p>{t(lang, 'footer.copyright')}</p>
		</footer>
	</body>
</html>

<script>
	function updateToggleIcon() {
		const isDark = document.documentElement.getAttribute('data-theme') === 'dark' ||
			(!document.documentElement.getAttribute('data-theme') && window.matchMedia('(prefers-color-scheme: dark)').matches);
		document.querySelectorAll('.theme-toggle').forEach((btn) => {
			btn.querySelector('.icon-sun')!.setAttribute('style', isDark ? 'display:none' : '');
			btn.querySelector('.icon-moon')!.setAttribute('style', isDark ? '' : 'display:none');
		});
	}

	document.querySelectorAll('.theme-toggle').forEach((btn) => {
		btn.addEventListener('click', () => {
			const current = document.documentElement.getAttribute('data-theme');
			const isDark = current === 'dark' ||
				(!current && window.matchMedia('(prefers-color-scheme: dark)').matches);
			const next = isDark ? 'light' : 'dark';
			document.documentElement.setAttribute('data-theme', next);
			localStorage.setItem('theme', next);
			updateToggleIcon();
		});
	});

	updateToggleIcon();
</script>

<style is:global>
	*, *::before, *::after {
		box-sizing: border-box;
	}
</style>

<style>
	:root {
		--color-heading: #111111;
		--color-text: #444444;
		--color-primary: #09637E;
		--color-secondary: #088395;
		--color-tertiary: #7AB2B2;
		--color-bg: #EBF4F6;
		--color-border: #b8d8dc;
		--color-surface: #d5e8eb;
	}

	@media (prefers-color-scheme: dark) {
		:root:not([data-theme="light"]) {
			--color-heading: #e8e8e8;
			--color-text: #b0b0b0;
			--color-primary: #3db8d9;
			--color-secondary: #2fcbdb;
			--color-tertiary: #5a9494;
			--color-bg: #121212;
			--color-border: #2a3a3d;
			--color-surface: #1e2a2d;
		}
	}

	[data-theme="dark"] {
		--color-heading: #e8e8e8;
		--color-text: #b0b0b0;
		--color-primary: #3db8d9;
		--color-secondary: #2fcbdb;
		--color-tertiary: #5a9494;
		--color-bg: #121212;
		--color-border: #2a3a3d;
		--color-surface: #1e2a2d;
	}

	html {
		font-family: 'Noto Sans', sans-serif;
		color: var(--color-text);
		background: var(--color-bg);
		height: 100%;
		display: flex;
		flex-direction: column;
		transition: color 0.3s ease, background 0.3s ease;
	}

	html *, html *::before, html *::after {
		transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
	}

	body {
		margin: 0 auto;
		padding: 1rem;
		min-height: 100%;
		display: flex;
		flex-direction: column;
	}

	main {
		flex: 1;
	}

	footer {
		max-width: 720px;
		width: 100%;
		margin: 3rem auto 0;
		padding: 1rem 0;
		border-top: 1px solid var(--color-border);
		color: var(--color-text);
		font-size: 0.875rem;
	}
</style>
